<html>
<head>
<style>
  @font-face {
    font-family: 'mplus_2p_black';
    src: url('mplus-2p-black-subset.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }
  body {
    margin: 0;
    position: absolute;
    overflow: hidden;
    background: #202123;
    font-family: mplus_2p_black; 
    color: transparent;
  }
  #preload-font {

  }
  html {
    height: 100%;
  }
</style>
</head>
<body>
<!-- <div style="font-family: mplus_2p_black; position: absolute; color: #202123; visibility: hidden;"> </div> -->
<script>
var w = document.body.clientWidth
var h = document.body.clientHeight
var size = 10;
var lines = Math.ceil(h/size);
var columns = Math.ceil(w/size);
var offset = (w - columns*size)/2;
// var fix = Math.floor(size * 0.05);
var fix = 1;
var c = document.createElement('canvas');
c.width = w;
c.height = h;
document.body.appendChild(c);

var c2 = document.createElement('canvas');
c2.width = w;
c2.height = h;

var animData = [];
var animData2 = [];

document.body.onload = function() {
  var ctx = c2.getContext('2d');

  ctx.font=size+"px mplus_2p_black";
  
  ctx.fillStyle = "#444444";
  
  for(var i = 0; i < lines; i++) {
    ctx.fillText(generateLine(columns),offset,(size-fix)+size*i); 
  }
  
  for(var i = 0; i < columns; i++) {
    var r = Math.floor(Math.random()*49)+7;
    var s = Math.floor(Math.random()*2)+1;
    var t = -Math.floor(Math.random()*40);
    var u = Math.floor(Math.random()*2);
    animData[i] = {len: r, frames: s, cycle: s, pos: t, two: u, sl: 0};
    r = Math.floor(Math.random()*49)+7;
    s = Math.floor(Math.random()*2)+1;
    t = -Math.floor(Math.random()*40)-40;
    u = Math.floor(Math.random()*2);
    animData2[i] = {len: r, frames: s, cycle: s, pos: t, two: u, sl: 1};
  }
    
  draw();
};

function draw() {
  requestAnimationFrame(draw); // do a time check... vs setTimeout? hm.. comparisons are quick right? polyfilling.
  // var s = Date.now();
  // setTimeout(draw, 1000);
  var ctx = c.getContext('2d');
     
  ctx.globalCompositeOperation = 'source-over';
  
  ctx.clearRect(0,0,w,h);
  
  for(var i = 0; i < columns; i++) {
    var ad = animData[i];
    if(ad.cycle++ >= ad.frames) {
      ad.cycle = 1;
      var j = (ad.frames === 1 && ad.two > 0) ? 2 : 1;
      while(j > 0) { 
        ad.pos++;
        if(ad.sl < ad.len) ad.sl++; 
        j--;
      }
      if(ad.pos-ad.len-1 > lines) ad.pos = -Math.floor(Math.random()*140);
    }
    // var start = Math.floor(Math.random()*lines)-8;
    // var end = Math.floor(Math.random()*(lines-4)+4+start);
    var start = ad.pos - ad.len -1;
    var end = ad.pos;
    var gradient=ctx.createLinearGradient(0,start*size,0,end*size);
    gradient.addColorStop(0.0,'rgba(40,160,70,0)');
    gradient.addColorStop(0.45,'rgba(40,160,70,1.0)');
    gradient.addColorStop(0.85,'rgba(40,160,70,1.0)');
    gradient.addColorStop(1.0,'rgba(110,240,140,1.0)');
    ctx.fillStyle=gradient;
    ctx.fillRect(offset+i*size,fix+(end-ad.sl)*size,size,(ad.sl+1)*size);
  }
  
  for(var i = 0; i < columns; i++) {
    var ad = animData2[i];
    if(ad.cycle++ >= ad.frames) {
      ad.cycle = 1;
      var j = (ad.frames === 1 && ad.two > 0) ? 2 : 1;
      while(j > 0) { 
        ad.pos++;
        if(ad.sl < ad.len) ad.sl++; 
        j--;
      }
      if(ad.pos-ad.len-1 > lines) ad.pos = -Math.floor(Math.random()*140);
    }
    // var start = Math.floor(Math.random()*lines)-8;
    // var end = Math.floor(Math.random()*(lines-4)+4+start);
    var start = ad.pos - ad.len -1;
    var end = ad.pos;
    var gradient=ctx.createLinearGradient(0,start*size,0,end*size);
    // gradient.addColorStop(0.0,'rgba(20,70,160,0)');
    // gradient.addColorStop(0.45,'rgba(20,70,160,1.0)');
    // gradient.addColorStop(0.85,'rgba(20,70,160,1.0)');
    // gradient.addColorStop(1.0,'rgba(60,140,240,1.0)');
    gradient.addColorStop(0.0,'rgba(40,160,70,0)');
    gradient.addColorStop(0.45,'rgba(40,160,70,1.0)');
    gradient.addColorStop(0.85,'rgba(40,160,70,1.0)');
    gradient.addColorStop(1.0,'rgba(110,240,140,1.0)');
    ctx.fillStyle=gradient;
    ctx.fillRect(offset+i*size,fix+(end-ad.sl)*size,size,(ad.sl+1)*size);
  }
    
  ctx.globalCompositeOperation = 'destination-in';
  ctx.drawImage(c2,0,0);
  // console.log(Date.now() - s, 'ms');
}

function generateLine(length) {
  var chars = "あいうえおかきくけこさしすせそたちつてとなにぬね"
            + "のはひふへほまみむめもやゆよらりるれろわゐゑをん"
            + "アイウエオカキクケコサシスセソタチツテトナニヌネ"
            + "ノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン";
  var text = "";
  for(var i = 0; i < length; i++) {
    var r = Math.floor(Math.random()*chars.length);
    text += chars.slice(r,r+1);
  }
  return text;
}

// generate the text - ask a mask!
// 
// 
// mask the stuff using https://developer.mozilla.org/samples/canvas-tutorial/6_1_canvas_composite.html
// source-in vs destenation-out
// 
// 
// 

</script>
</body>
</html>